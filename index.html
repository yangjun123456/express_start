<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="./jquery-3.3.1.min.js"></script>
    <title>Document</title>
</head>

<body>
    <form class="initform" method="post" accept-charset="utf-8">
        <div class="from-group">
            <label>输入内容</label>
            <input class="form-control createContent" type="text" name="content" placeholder="Enter Todo" />
        </div>
        <div class="from-group" style="margin: 10px 0px;">
            <button type="button" class="btn btn-info" onclick="ceateItem()">新增</button>
        </div>
    </form>
    <div class="content"></div>
    <button class="btn btn-default" id="btn" onclick="searchItem()">查询全部</button>

    <!-- <div id="lists" class="alert alert-success" click="edit(event)" style="padding: 0;height: 50px;line-height: 50px;padding-left: 10px;">
        <p style="width: 90%;display: inline-block;" id="${res[i]._id}">${res[i].content}</p>
        <p class="pdelete" title="删除该数据" style=" display: inline-block;">
            <button type="button" class="close">
                <span aria-hidden="true" onclick="deleteItem('asldkfjasdfl')" nodeValue="${res[i]._id}">×</span>
                <span class="sr-only">Close</span>
            </button>
        </p>
    </div> -->

    <script>
        document.cookie = 'asdfll=asdfsdf';
        localStorage.cookiess = 'asdfasdf';

        $.ajax({
            url:'./test.json',
            type:'GET',
            success:()=>{
                // alert('success');
            },
            error:()=>{
                alert('error');
            }
        })

        //创建数据
        function ceateItem() {
            var obj = {};
            obj.content = $('.createContent').val();
            if (obj.content != '') {
                // $.post('http://localhost:3000/create', obj, function (res) {
                //     console.log('新增成功');
                //     searchItem();
                // })

                $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/create",
                    data: obj,
            　　　　// 允许携带证书
                    xhrFields: {
                        withCredentials: true
                    },
            　　　　// 允许跨域
                    crossDomain: true,
                    success:()=>{
                        alert('success');
                        searchItem();
                    },
                    error:()=>{
                        alert('asdfasfd');
                    }
                })


               } else {
                alert('不能为空');
            }
        }

        // 查询全部
        function searchItem() {


            $.get('http://localhost:3000/search', function (res) {
                console.log(res);
                $(".content").empty();
                for (var i = 0; i < res.length; i++) {
                    $(".content").append(`
                     <div id="lists" class="alert alert-success" click="edit(event)" style="padding: 0;height: 50px;line-height: 50px;padding-left: 10px;">
                     <p  style="width: 90%;display: inline-block;" id="${res[i]._id}" >${res[i].content}</p>
                    <p class="pdelete" title="删除该数据" style=" display: inline-block;">
                        <button type="button" class="close"><span aria-hidden="true" onclick="deleteItem(event)"  nodeValue="${res[i]._id}">×</span><span class="sr-only">Close</span></button>
                    </p>
                </div>
                     `)
                }
            })

            $.ajax({
                    type: "GET",
                    url: 'http://localhost:3000/search',
            　　　　// 允许携带证书
            //         xhrFields: {
            //             withCredentials: true
            //         },
            // 　　　　// 允许跨域
            //         crossDomain: true,
                    success:(res)=>{
                        console.log(res);
                        $(".content").empty();
                        for (var i = 0; i < res.length; i++) {
                            $(".content").append(`
                            <div id="lists" class="alert alert-success" click="edit(event)" style="padding: 0;height: 50px;line-height: 50px;padding-left: 10px;">
                            <p  style="width: 90%;display: inline-block;" id="${res[i]._id}" >${res[i].content}</p>
                            <p class="pdelete" title="删除该数据" style=" display: inline-block;">
                                <button type="button" class="close"><span aria-hidden="true" onclick="deleteItem(event)"  nodeValue="${res[i]._id}">×</span><span class="sr-only">Close</span></button>
                            </p>
                        </div>
                            `)
                        }
                        alert('success');
                    },
                    error:()=>{
                        alert('asdfasfd');
                    }
                })
        }

        // 删除数据
        function deleteItem(e) {
            console.log(e.target.getAttribute('nodeValue'));
            const id = e.target.getAttribute('nodeValue');
            $.get('http://localhost:3000/destroy', {id:id}, function (res) {
                console.log(res);
                searchItem();
            })
        }
    </script>


    <form action="http://localhost:3000/testJson/add" method="post" id="myForm" target="frame1">
        <input type="text" name='id' value='123123'>
        <input type="text" name='name' value='123123'>
        <input type="text" name='age' value='123123'>
        <button type='submit'>提交</button>
    </form>
    <iframe name="frame1" frameborder="0" id="frame" style='display:none;'></iframe>
    <button id='add'>add</button>
    <button id='delet'>delete</button>
    <button id='change'>change</button>
    <button id='get'>get</button>

    <script>
        const add = document.querySelector('#add');
        const delet = document.querySelector('#delet');
        const change = document.querySelector('#change');
        const get = document.querySelector('#get');

        add.onclick = () => {
            addData();
        }
        delet.onclick = () => {
            deletData();
        }
        change.onclick = () => {
            changeData();
        }
        get.onclick = () => {
            getData();
        }

        function addData() {
            $.ajax({
                type: 'POST',
                url: "http://localhost:3000/testJson/add",

                data: {
                    "id": $('input[name=id]').val(),
                    "name": $('input[name=name]').val(),
                    "age": $('input[name=age]').val()
                },
                success: function (data) {
                    console.log('success', data);
                },
                error: function (error) {
                    console.log(error);
                },
            })
        };

        function deletData() {
            $.ajax({
                type: 'post',
                url: "http://localhost:3000/testJson/delete",

                data: {
                    "id": $('input[name=id]').val(),
                    "name": $('input[name=name]').val(),
                    "age": $('input[name=age]').val()
                },
                success: function (data) {
                    console.log('success', data);
                },
                error: function (error) {
                    console.log(error);
                },
            })
        };

        function changeData() {
            $.ajax({
                type: 'post',
                url: "http://localhost:3000/testJson/change",

                data: {
                    "id": $('input[name=id]').val(),
                    "name": $('input[name=name]').val(),
                    "age": $('input[name=age]').val()
                },
                success: function (data) {
                    console.log('success', data);
                },
                error: function (error) {
                    console.log(error);
                },
            })
        };

        function getData() {
            $.ajax({
                type: 'GET',
                url: "http://localhost:3000/testJson/getData",
                // data: {},
                success: function (data) {
                    console.log('success', data);
                },
                error: function (error) {
                    console.log(error);
                },
            })
        };
    </script>
</body>

</html>